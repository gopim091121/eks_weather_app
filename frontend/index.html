<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Weather App</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
    h1 { color: #333; }
    .container { max-width: 600px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
    .status { margin-bottom: 10px; }
    input, button { padding: 8px; margin: 5px 0; }
    .result { margin-top: 15px; padding: 10px; border-radius: 4px; background: #eef; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Weather App</h1>
    <div id="status" class="status">Checking backend health...</div>

    <label for="city">City:</label>
    <input type="text" id="city" value="London" />
    <button onclick="fetchWeather()">Get Weather</button>

    <div id="result" class="result"></div>
  </div>

  <script>
    async function checkHealth() {
      try {
        const res = await fetch('/api/health');
        if (!res.ok) throw new Error('Backend not healthy');
        const data = await res.json();
        document.getElementById('status').textContent =
          'Backend status: ' + data.status;
      } catch (err) {
        document.getElementById('status').textContent =
          'Backend health check failed: ' + err.message;
      }
    }

    async function fetchWeather() {
      const city = document.getElementById('city').value || 'London';
      const resultDiv = document.getElementById('result');
      resultDiv.textContent = 'Loading...';

      try {
        const res = await fetch('/api/weather?city=' + encodeURIComponent(city));
        if (!res.ok) {
          const errData = await res.json().catch(() => ({}));
          throw new Error(errData.error || 'Request failed');
        }
        const data = await res.json();
        resultDiv.innerHTML = `
          <strong>${data.city}</strong><br/>
          Temperature: ${data.temperature} Â°C<br/>
          Description: ${data.description}
        `;
      } catch (err) {
        resultDiv.textContent = 'Error: ' + err.message;
      }
    }

    checkHealth();
  </script>
</body>
</html>